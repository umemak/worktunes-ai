'use client';\n\nimport { useState, useRef, useEffect } from 'react';\nimport { Play, Pause, SkipForward, Volume2, Settings } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { Slider } from '@/components/ui/slider';\nimport { Card, CardContent } from '@/components/ui/card';\nimport { Badge } from '@/components/ui/badge';\nimport { BGMResponse } from '@worktunes/types';\n\ninterface GensparkMusicPlayerProps {\n  currentTrack: BGMResponse | null;\n  isPlaying: boolean;\n  onPlay: () => void;\n  onPause: () => void;\n  onSkip: () => void;\n  onVolumeChange?: (volume: number) => void;\n  className?: string;\n}\n\nexport const GensparkMusicPlayer: React.FC<GensparkMusicPlayerProps> = ({\n  currentTrack,\n  isPlaying,\n  onPlay,\n  onPause,\n  onSkip,\n  onVolumeChange,\n  className = ''\n}) => {\n  const [currentTime, setCurrentTime] = useState(0);\n  const [volume, setVolume] = useState(0.7);\n  const [showDetails, setShowDetails] = useState(false);\n  const audioRef = useRef<HTMLAudioElement>(null);\n\n  // ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªè¦ç´ ã®åˆ¶å¾¡\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio || !currentTrack) return;\n\n    audio.src = currentTrack.audioUrl;\n    audio.volume = volume;\n\n    if (isPlaying) {\n      audio.play().catch(console.error);\n    } else {\n      audio.pause();\n    }\n  }, [currentTrack, isPlaying, volume]);\n\n  // å†ç”Ÿé€²æ—ã®æ›´æ–°\n  useEffect(() => {\n    const audio = audioRef.current;\n    if (!audio) return;\n\n    const updateTime = () => setCurrentTime(audio.currentTime);\n    const handleEnded = () => onSkip();\n\n    audio.addEventListener('timeupdate', updateTime);\n    audio.addEventListener('ended', handleEnded);\n\n    return () => {\n      audio.removeEventListener('timeupdate', updateTime);\n      audio.removeEventListener('ended', handleEnded);\n    };\n  }, [onSkip]);\n\n  // éŸ³é‡å¤‰æ›´\n  const handleVolumeChange = (newVolume: number[]) => {\n    const vol = newVolume[0] / 100;\n    setVolume(vol);\n    if (audioRef.current) {\n      audioRef.current.volume = vol;\n    }\n    onVolumeChange?.(vol);\n  };\n\n  // å†ç”Ÿä½ç½®å¤‰æ›´\n  const handleSeek = (position: number[]) => {\n    if (audioRef.current && currentTrack) {\n      const newTime = (position[0] / 100) * currentTrack.metadata.duration;\n      audioRef.current.currentTime = newTime;\n      setCurrentTime(newTime);\n    }\n  };\n\n  // æ™‚é–“ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  // Gensparkãƒ¢ãƒ‡ãƒ«æƒ…å ±ã®è¡¨ç¤º\n  const getModelInfo = () => {\n    if (!currentTrack?.metadata) return null;\n    \n    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰Gensparkãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’æŠ½å‡ºï¼ˆä»®æƒ³ï¼‰\n    const model = 'ElevenLabs Music'; // å®Ÿéš›ã¯APIãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰å–å¾—\n    const quality = 'High Quality';\n    \n    return { model, quality };\n  };\n\n  if (!currentTrack) {\n    return (\n      <Card className={`music-player ${className}`}>\n        <CardContent className=\"p-6\">\n          <div className=\"text-center text-gray-500\">\n            <div className=\"mb-4\">\n              <div className=\"w-16 h-16 bg-gray-200 rounded-full mx-auto mb-3 flex items-center justify-center\">\n                <Volume2 className=\"w-8 h-8 text-gray-400\" />\n              </div>\n              <p className=\"text-sm\">éŸ³æ¥½ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„</p>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    );\n  }\n\n  const progress = currentTrack.metadata.duration > 0 \n    ? (currentTime / currentTrack.metadata.duration) * 100 \n    : 0;\n\n  const modelInfo = getModelInfo();\n\n  return (\n    <>\n      <audio ref={audioRef} />\n      \n      <Card className={`music-player ${className}`}>\n        <CardContent className=\"p-6\">\n          {/* æ¥½æ›²æƒ…å ± */}\n          <div className=\"mb-4\">\n            <div className=\"flex items-start justify-between mb-2\">\n              <div className=\"flex-1 min-w-0\">\n                <h3 className=\"font-medium text-lg truncate\">\n                  {currentTrack.metadata.title}\n                </h3>\n                <div className=\"flex items-center gap-2 mt-1\">\n                  <Badge variant=\"secondary\" className=\"text-xs\">\n                    {currentTrack.metadata.genre}\n                  </Badge>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {currentTrack.metadata.bpm} BPM\n                  </Badge>\n                  <Badge variant=\"outline\" className=\"text-xs\">\n                    {currentTrack.metadata.key}\n                  </Badge>\n                </div>\n              </div>\n              \n              <Button\n                variant=\"ghost\"\n                size=\"sm\"\n                onClick={() => setShowDetails(!showDetails)}\n              >\n                <Settings className=\"w-4 h-4\" />\n              </Button>\n            </div>\n\n            {/* Gensparkãƒ¢ãƒ‡ãƒ«æƒ…å ± */}\n            {showDetails && modelInfo && (\n              <div className=\"bg-blue-50 rounded-lg p-3 mb-3\">\n                <div className=\"text-xs text-blue-700 font-medium mb-1\">\n                  ğŸµ Powered by Genspark AI\n                </div>\n                <div className=\"text-xs text-blue-600\">\n                  Model: {modelInfo.model} â€¢ Quality: {modelInfo.quality}\n                </div>\n              </div>\n            )}\n          </div>\n\n          {/* é€²æ—ãƒãƒ¼ */}\n          <div className=\"mb-4\">\n            <Slider\n              value={[progress]}\n              onValueChange={handleSeek}\n              max={100}\n              step={0.1}\n              className=\"w-full\"\n            />\n            <div className=\"flex justify-between text-xs text-gray-500 mt-1\">\n              <span>{formatTime(currentTime)}</span>\n              <span>{formatTime(currentTrack.metadata.duration)}</span>\n            </div>\n          </div>\n\n          {/* åˆ¶å¾¡ãƒœã‚¿ãƒ³ */}\n          <div className=\"flex items-center justify-center gap-4 mb-4\">\n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={isPlaying ? onPause : onPlay}\n              className=\"w-12 h-12\"\n            >\n              {isPlaying ? (\n                <Pause className=\"w-5 h-5\" />\n              ) : (\n                <Play className=\"w-5 h-5\" />\n              )}\n            </Button>\n            \n            <Button\n              variant=\"outline\"\n              size=\"icon\"\n              onClick={onSkip}\n            >\n              <SkipForward className=\"w-4 h-4\" />\n            </Button>\n          </div>\n\n          {/* éŸ³é‡åˆ¶å¾¡ */}\n          <div className=\"flex items-center gap-3\">\n            <Volume2 className=\"w-4 h-4 text-gray-500\" />\n            <Slider\n              value={[volume * 100]}\n              onValueChange={handleVolumeChange}\n              max={100}\n              step={1}\n              className=\"flex-1\"\n            />\n          </div>\n\n          {/* ç’°å¢ƒæƒ…å ±è¡¨ç¤º */}\n          {showDetails && (\n            <div className=\"mt-4 pt-4 border-t border-gray-200\">\n              <div className=\"text-xs text-gray-600\">\n                <div className=\"mb-1\">\n                  <strong>Environment:</strong> {currentTrack.environment.timeOfDay} â€¢ {currentTrack.environment.weather.condition}\n                </div>\n                <div className=\"mb-1\">\n                  <strong>Temperature:</strong> {currentTrack.environment.weather.temperature}Â°C\n                </div>\n                <div>\n                  <strong>Generated:</strong> {new Date(currentTrack.generatedAt).toLocaleString()}\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </>\n  );\n};\n\nexport default GensparkMusicPlayer;